<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='Styles.css') }}">
    <title>Users</title>
</head>
<body>

    <h1>Users</h1>
    <!-- Users table pulled from app.py -->
    <table>
        <thead>
            <tr>
               <th>UserID</th>
                <th>Full Name</th>
                <th>Email Address</th>
                <th>Sys Role</th>
                <th>Is Active</th>
                {% if session.get('Sys_Role') == 'Admin' %}
                    <th>Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
          <!-- create a loop for each row -->
            {% for user in user_list %}
            <tr>
                <td>{{ user[0] }}</td> 
                <td>{{ user[1] }}</td> 
                <td>{{ user[2] }}</td> 
                <td>{{ user[3] }}</td> 
                <td>{{ 'Yes' if user[5] == 1 else 'No' }}</td> 
                <!-- Edit user button -->
                <td>
                    <form action="{{ url_for('edit_user', user_id=user[0]) }}" method="get">
                        <button class="edit-btn">Edit User</button>
                        </form>
<!--The delete function needs creating - Only for admins-->
                {% if session.get('Sys_Role') == 'Admin' %}
                    <form action="{{ url_for('delete_user', user_id=user[0]) }}" method="post">
                        <button class="Delete-btn">Delete User</button>
                    </form>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- create user section -->
    
    <div class="form-container">
        <h3>{{ 'Edit User' if edit_user else 'Create New User' }}</h3>

        <form method="post" action="{{ url_for('save_user') }}">
            <!--If edit we want the ID to be hidden but to pass through the row ID... for  create user, an ID is needed so the field shows-->
            {% if edit_asset %}
            <input type="hidden" name="user_id" placeholder="User ID (do not leave blank)" value="{{ edit_user[0]}}">
            {% else %}
            <input type="text" name="user_id" placeholder="User ID (do not leave blank)" value="{{ edit_user[0]}}">
            {% endif %}
            
            <div class="input-group">
                <input type="text" name="full_name" placeholder="Full name"
                       value="{{ edit_user[1] if edit_user else '' }}" required>

                <input type="email" name="email" placeholder="Email"
                       value="{{ edit_user[2] if edit_user else '' }}" required>
                    
                <!-- Password is only required for new users -->
                <input type="password" name="password" placeholder="Password"
                       {% if not edit_user %}required{% endif %}>

                <select name="sys_role">
                    <option value="User" {{ 'selected' if edit_user and edit_user[3]=='User' }}>User</option>
                    <option value="Admin" {{ 'selected' if edit_user and edit_user[3]=='Admin' }}>Admin</option>
                </select>

                <label>
                    <input type="checkbox" name="is_active"
                           {{ 'checked' if edit_user and edit_user[5] == 1 }}>
                    Active
                </label>

                <button type="submit" class="btn-primary">
                    {{ 'Update User' if edit_user else 'Create User' }}
                </button>
                
                {% if edit_user %}
                    <a href="{{ url_for('users') }}" class="btn-secondary">Cancel</a>
                {% endif %}
            </div>
        </form>
    </div>
    

</body>
<h3> <a href="{{ url_for('dashboard') }}" class="dashbtn">Back to Dashboard</a></H3>
</html>
